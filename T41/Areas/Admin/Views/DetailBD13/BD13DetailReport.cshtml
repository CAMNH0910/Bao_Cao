@{
//  Layout = null;
}

<!-- daterange picker -->
<link rel="stylesheet" href="/Areas/Admin/Content/bower_components/bootstrap-daterangepicker/daterangepicker.css">
<link rel="stylesheet" href="~/Areas/Admin/Content/bower_components/bootstrap-datepicker/dist/css/bootstrap-datepicker.css">
<link rel="stylesheet" href="/Areas/Admin/Content/bower_components/font-awesome/css/font-awesome.min.css">
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css" rel="stylesheet" />

<title>Chi tiết e1 bd13 đi</title>
<section class="content">
    <div class="box box-default">
        <div class="box-header with-border">
            <h3 class="box-title">Chi tiết e1 bd13 đi</h3>
            <div class="box-tools pull-right">
                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-remove"></i></button>
            </div>
        </div>
        <!-- /.box-header -->
        <div class="box-body">
            <div class="row">
                <div class="col-md-4">
                    <div class="form-group">
                        <label>Ngày </label>
                        <div class="input-group date">
                            <div class="input-group-addon">
                                <i class="fa fa-calendar"></i>
                            </div>
                            <input class="form-control pull-right" id="date" type="text" data-date-format="dd/mm/yyyy">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Bưu cục phát</label>
                        <select class="form-control select2" style="width: 100%;" id="endpostcode">
                            <option selected="selected" value="0">Tất cả</option>

                        </select>
                    </div>
                    
                    <!-- /.form-group -->
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <label>Ca Khai Thác</label>
                        <select class="form-control" style="width: 100%;" id="ca">
                            <option selected="selected" value="1">Ca 1</option>
                            <option value="2">Ca 2</option>
                            <option value="3">Ca 3</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Tuyến phát</label>
                        <select class="form-control select2" style="width: 100%;" id="routecode">
                            <option selected="selected" value="0">Tất cả</option>
                        </select>
                    </div>
                    
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <label>Chuyến Thư</label>
                        <input class="form-control " onkeyup="if (/\D/g.test(this.value)) this.value = this.value.replace(/\D/g,'')" type="text" id="chthu">
                    </div>
                    <div class="form-group">
                        <label>Túi Số</label>
                        <input class="form-control " onkeyup="if (/\D/g.test(this.value)) this.value = this.value.replace(/\D/g,'')" type="text" id="tuiso">
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-4">
                    <button type="button" class="btn btn-default btn-lrg ajax" id="btnreport">Hiển Thị</button>
                </div>
            </div>
            
            @*<div class="box-header">
                <h3 class="box-title">Chi tiết bưu gửi</h3>
            </div>*@
            
            <div class="loading-element">
                <i class="fa fa-spinner fa-spin"></i>
                Vui lòng chờ giây lát...
            </div>
            <div style="overflow-x:auto;">
                <table id="listbd13report" class="table table-bordered table-hover"></table>
            </div>
            

            <div class="row">
                <div id="page-selection" class="col-sm-12 text-center">
                </div>
            </div>
            
            
            
        </div>
        
    </div>


   





</section>


<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js"></script>
<script>
    $(document).ready(function () {
        $('.select2').select2();

        $("#date").datepicker({
            dateFormat: "dd/mm/yyyy"
        }).datepicker("setDate", "0");

    });


    $("#btnreport").click(function () {
        // goi ham Detail
        $("#listbd13report tr").remove();
        detail(1);

    });

    $(document).ready(function () {
        $('.loading-element').hide();
    });

    //Phần chi tiết của bảng tổng hợp sản lượng đi phát
    function detail(p) {
        var chthu;
        var tuiso;

        if (document.getElementById('chthu').value == ""
        || document.getElementById('chthu').value == undefined) {
            chthu = 0;
        }
        else {
            chthu = document.getElementById('chthu').value;
        }

        if (document.getElementById('tuiso').value == ""
        || document.getElementById('tuiso').value == undefined) {
            tuiso = 0;
        }
        else {
            tuiso = document.getElementById('tuiso').value;
        }

        $.ajax({
            url: '@Url.Action("ListDetailedBD13Report", "DetailBD13")',
            beforeSend: function () {
                $('.loading-element').show();
            },
            dataType: 'html',
            data:
                {
                    page :p,
                    mabc_kt: $("#endpostcode").val(),
                    mabc: $("#routecode").val(),
                    ngay: $('#date').val(),
                    cakt: $("#ca").val(),
                    chthu: chthu,
                    tuiso: tuiso
                    
                },
            success: function (result) {
                // sau khi chay ham thanh cong lay ra ket qua thi bind html vao id listbd13report
                    $('.loading-element').hide();
                    $('#listbd13report').html(result);

                    if (p == 1) refreshPaging();
            }
        })
    }

    //Phần Phân Trang
    function refreshPaging() {
        $('#page-selection').bootpag({
            total: $('#total_page').val(),
            maxVisible: 10,
        }).on("page", function (event, /* page number here */ num) {
            detail(num);
            $("#listbd13report tr").remove();
        });
    }

    

    //Phần lấy dữ liệu của bưu cục phát
    $(document).ready(function () {

        $.getJSON("/DetailBD13/ListPostCode", function (data) {
            $.each(data, function (i, data) {

                $('<option>',
                   {
                       value: data.POST_CODE,
                       text: data.POST_CODE_NAME
                   }).html(data.POST_CODE + '-' + data.POST_CODE_NAME).appendTo("#endpostcode");
            });
        })

    });

    //Sự kiện thay đổi tuyến phát theo bưu cục phát
    $(document).ready(function () {
        $('#endpostcode').change(function () {
            $.ajax({
                url: "/DetailBD13/ListDeliveryRouteByPostCode",
                dataType: "json",
                data: { delivery_post_code: $("#endpostcode").val() },
                success: function (data) {
                    $('#routecode').html('<option value=0>Tuyến Phát </option>');
                    jQuery.each(data, function (i, val) {
                        $('#routecode').html($('#routecode').html() +
                            "<option value='" + val.POST_CODE + "'>" + val.POST_CODE + '-' + val.POST_CODE_NAME + "</option>");
                    });
                }
            });
        })
    });


</script>


